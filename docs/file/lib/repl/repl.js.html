<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">lib/repl/repl.js | eggtended-js</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A extended version of the Egg programming language from the Eloquent Javascript book."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="eggtended-js"><meta property="twitter:description" content="A extended version of the Egg programming language from the Eloquent Javascript book."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/repl/repl.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const process = require(&quot;process&quot;);
const readline = require(&quot;readline&quot;);

const { Lexer } = require(&quot;../parser/lexer.js&quot;);
const { Parser } = require(&quot;../parser/parse.js&quot;);
const { TopEnv } = require(&quot;../interp/environment.js&quot;);
const { Eggvm } = require(&quot;../interp/eggvm.js&quot;);

const extensions = require(&quot;./extensions.js&quot;);
const colors = require(&quot;./colors.js&quot;);

const repl = () =&gt; {
  // Create the REPL environment
  const topEnv = Object.create(TopEnv);
  const lexer = new Lexer();
  const parser = new Parser();

  let program = &quot;&quot;;
  let stack = 0;

  extensions.eggInfo();

  try {
    const rl = readline.createInterface(process.stdin, process.stdout, line =&gt; {
      return extensions.eggCompleter(line, topEnv);
    });

    rl.setPrompt(extensions.getPromptLine());
    rl.prompt();

    rl.on(&quot;line&quot;, line =&gt; {
      program += line + &quot;\n&quot;;

      // Count the number of LPS (+) or RPS (-)
      stack = lexer.getParBalance(program);

      if (stack &lt;= 0) {
        try {
          Eggvm.eval(parser.parse(program), topEnv);
        } catch (err) {
          console.log(`${colors.RED} Error:: ${err} ${colors.DEFAULT}`);
        } finally {
          program = &quot;&quot;;
          stack = 0;
        }
      }

      rl.setPrompt(extensions.getPromptLine() + &quot;..&quot;.repeat(stack));
      rl.prompt();
    });

    rl.on(&quot;close&quot;, extensions.eggExit);

    rl.on(&quot;SIGINT&quot;, () =&gt; {
      console.log(
        `\n${colors.GREEN}\n--&gt; Expression discarded ${colors.DEFAULT}`
      );

      program = &quot;&quot;;
      stack = 0;

      rl.clearLine(process.stdout);

      rl.setPrompt(extensions.getPromptLine());
      rl.prompt();
    });
  } catch (err) {
    console.log(err);
    extensions.eggHelp();
  }
};

module.exports = {
  repl
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
